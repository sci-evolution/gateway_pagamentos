# syntax=docker/dockerfile:1

ARG GO_VERSION=1.23.7

FROM mcr.microsoft.com/devcontainers/go:${GO_VERSION}

# Set development environment
ENV GO_ENV development

# Set working directory
WORKDIR /usr/src/app

# Install Air for live-reloading during development
# Air watches your Go files and automatically rebuilds/restarts the app when you make changes
RUN go install github.com/cosmtrek/air@latest

# Create a basic Air configuration file
RUN echo '# .air.toml\n\
root = "."\n\
tmp_dir = "tmp"\n\
[build]\n\
  cmd = "go build -o ./tmp/main ./cmd/app/main.go"\n\
  bin = "./tmp/main"\n\
  exclude_dir = ["tmp", "vendor"]\n\
  include_ext = ["go", "tpl", "tmpl", "html"]\n\
  exclude_regex = ["_test.go"]\n\
[misc]\n\
  clean_on_exit = true' > .air.toml

# Expose API port
EXPOSE 8080

# Use Air to run the application with live-reload
# This will automatically rebuild and restart when you make changes
CMD ["air", "-c", ".air.toml"]